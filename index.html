<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DL engineer</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: #fff; overflow: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    header{
      position: fixed;
      left: 0; right: 0; top: 0;
      height: 44px;
      display: flex;
      align-items: center;
      padding: 0 14px;
      font-size: 14px;
      font-weight: 650;
      border-bottom: 1px solid rgba(0,0,0,0.10);
      background: #fff;
      user-select: none;
      z-index: 10;
    }

    .runner{
      position: fixed;
      left: 0; top: 0;
      width: 56px; height: 56px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1000;
      will-change: left, top, transform, opacity, filter;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,0.10));
    }
    .man{
      width: 56px; height: 56px;
      transform-origin: 50% 50%;
      transform: scaleX(1);
    }
    .man svg { width: 56px; height: 56px; display: block; }

    /* Yellow body vanish on death */
    .runner.dying .man{
      opacity: 0;
      transform: scaleX(var(--face, 1)) scale(0.88);
      transition: opacity 140ms ease, transform 180ms ease;
    }

    /* Soul (more visible + slower ascent) */
    .soul{
      position: fixed;
      left: 0; top: 0;
      width: 58px; height: 58px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 1500;

      /* More visible: brighter + outline + glow */
      opacity: 0;
      filter:
        drop-shadow(0 12px 18px rgba(0,0,0,0.08))
        drop-shadow(0 0 10px rgba(255,255,255,0.90));
      will-change: left, top, opacity, filter;
    }
    .soul svg { width: 58px; height: 58px; display: block; }
    .soul.on{
      opacity: 1;
      transition: opacity 140ms ease;
    }

    /* Speech bubble */
    .bubble{
      position:absolute;
      left: 60px;
      top: -6px;
      max-width: 280px;
      padding: 8px 10px;
      border-radius: 14px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.14);
      color: rgba(0,0,0,0.80);
      font-size: 12px;
      line-height: 1.25;
      box-shadow: 0 12px 30px rgba(0,0,0,0.10);
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity .16s ease, transform .16s ease;
      white-space: normal;
    }
    .bubble.on{ opacity: 1; transform: translateY(0); }
    .bubble:after{
      content:"";
      position:absolute;
      left: -6px; top: 18px;
      width: 10px; height: 10px;
      background: #fff;
      border-left: 1px solid rgba(0,0,0,0.14);
      border-bottom: 1px solid rgba(0,0,0,0.14);
      transform: rotate(45deg);
    }

    /* Fireball explosion */
    .boom{
      position: fixed;
      left: 0; top: 0;
      width: 10px; height: 10px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 2000;
      mix-blend-mode: multiply;
      filter: saturate(1.25);
    }
    .boom .shock{
      position:absolute;
      left:50%; top:50%;
      width: 20px; height: 20px;
      border-radius: 999px;
      border: 2px solid rgba(255, 70, 0, 0.38);
      transform: translate(-50%, -50%) scale(0.12);
      opacity: 0.95;
      animation: shock 620ms cubic-bezier(.1,.8,.2,1) forwards;
    }
    .boom .flash{
      position:absolute;
      left:50%; top:50%;
      width: 26px; height: 26px;
      border-radius: 999px;
      transform: translate(-50%, -50%) scale(0.12);
      background: radial-gradient(circle at 35% 35%,
        rgba(255,255,255,0.95) 0%,
        rgba(255,220,120,0.95) 22%,
        rgba(255,120,0,0.85) 48%,
        rgba(255,40,0,0.55) 72%,
        rgba(255,40,0,0.0) 100%);
      animation: flash 520ms ease-out forwards;
      opacity: 1;
      filter: blur(0.2px);
    }
    .boom .puff{
      position:absolute;
      left:50%; top:50%;
      width: var(--s);
      height: var(--s);
      border-radius: 999px;
      transform: translate(-50%, -50%) scale(0.12);
      opacity: 0.9;
      background: radial-gradient(circle at 35% 35%,
        rgba(255,255,255,0.85) 0%,
        rgba(255,230,140,0.85) 22%,
        rgba(255,140,0,0.78) 50%,
        rgba(255,55,0,0.45) 78%,
        rgba(255,55,0,0.00) 100%);
      filter: blur(0.4px);
      animation: puff 760ms cubic-bezier(.12,.8,.18,1) forwards;
    }
    .boom .smoke{
      position:absolute;
      left:50%; top:50%;
      width: var(--s);
      height: var(--s);
      border-radius: 999px;
      transform: translate(-50%, -50%) scale(0.12);
      opacity: 0.45;
      background: radial-gradient(circle at 40% 40%,
        rgba(60,60,60,0.35) 0%,
        rgba(60,60,60,0.22) 45%,
        rgba(60,60,60,0.00) 100%);
      filter: blur(0.9px);
      animation: smoke 980ms cubic-bezier(.12,.8,.18,1) forwards;
      mix-blend-mode: normal;
    }

    @keyframes flash{
      0%   { transform: translate(-50%, -50%) scale(0.12); opacity: 0.95; }
      35%  { transform: translate(-50%, -50%) scale(1.25); opacity: 0.75; }
      100% { transform: translate(-50%, -50%) scale(2.25); opacity: 0; }
    }
    @keyframes shock{
      0%   { transform: translate(-50%, -50%) scale(0.12); opacity: 0.9; }
      100% { transform: translate(-50%, -50%) scale(3.2); opacity: 0; }
    }
    @keyframes puff{
      0%   { transform: translate(-50%, -50%) scale(0.18); opacity: 0.9; }
      55%  { opacity: 0.55; }
      100% { transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1.65); opacity: 0; }
    }
    @keyframes smoke{
      0%   { transform: translate(-50%, -50%) scale(0.18); opacity: 0.18; }
      35%  { opacity: 0.30; }
      100% { transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(2.1); opacity: 0; }
    }
  </style>
</head>
<body>
  <header>DL engineer</header>

  <script>
  (() => {
    const MAX_MEN = 15;
    const EXPLOSION_RADIUS = 130;
    const HEADER_H = 44;

    const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;
    const CFG = {
      accel: prefersReducedMotion ? 0.004 : 0.020,
      maxSpeed: prefersReducedMotion ? 0.45 : 1.60,
      friction: 0.86,
      catchRadius: 12,
      stopMs: 240,
      speakMs: 1300,
      speakCooldownMs: 650,
    };

    // Soul tuning (slower + more present)
    const SOUL = {
      risePxPerMs: 0.55,        // slower than before (was ~1.0+)
      lifeMs: 2600,             // longer life
      driftX: 180,              // sideways drift range
      waveAmp: [18, 26],        // bigger wave so it's noticeable
      waveFreq: [0.008, 0.012], // slower wave
      fadeStart: 900,           // start fading later
      stroke: "rgba(0,0,0,0.18)"// subtle outline
    };

    window.addEventListener("contextmenu", (e) => e.preventDefault());

    let target = { x: window.innerWidth * 0.6, y: window.innerHeight * 0.6 };
    let hasPointer = false;
    function setTarget(x, y) { hasPointer = true; target.x = x; target.y = y; }
    window.addEventListener("pointermove", (e) => setTarget(e.clientX, e.clientY), { passive: true });

    const men = [];

    function manSVG(fill, outline = null) {
      const stroke = outline ? ` stroke="${outline}" stroke-width="1.2"` : "";
      return `
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <circle cx="32" cy="14" r="9.2" fill="${fill}"${stroke}/>
          <ellipse cx="32" cy="33" rx="10.8" ry="14.2" fill="${fill}"${stroke}/>
          <path d="M23.5 28
                   C16.8 30 12.5 35 11.6 38.8
                   C11.0 41.5 14.2 43.3 16.3 41.0
                   C18.7 38.3 20.7 35.6 26.2 34.6
                   Z" fill="${fill}"${stroke}/>
          <path d="M40.5 28
                   C47.2 30 51.5 35 52.4 38.8
                   C53.0 41.5 49.8 43.3 47.7 41.0
                   C45.3 38.3 43.3 35.6 37.8 34.6
                   Z" fill="${fill}"${stroke}/>
          <path d="M29.3 44
                   C25.0 50.0 22.0 54.5 21.2 58
                   C20.8 60.6 24.5 61.4 26.3 59.0
                   C29.4 55.0 31.6 50.2 33.4 47.0
                   Z" fill="${fill}"${stroke}/>
          <path d="M34.7 44
                   C39.0 50.0 42.0 54.5 42.8 58
                   C43.2 60.6 39.5 61.4 37.7 59.0
                   C34.6 55.0 32.4 50.2 30.6 47.0
                   Z" fill="${fill}"${stroke}/>
        </svg>
      `;
    }

    function makeRunnerElement() {
      const el = document.createElement("div");
      el.className = "runner";

      const man = document.createElement("div");
      man.className = "man";
      man.innerHTML = manSVG("#FFD400");

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = "smnth will be later here, now go away";

      el.appendChild(man);
      el.appendChild(bubble);
      document.body.appendChild(el);

      return { el, man, bubble };
    }

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function spawnMan(x, y) {
      if (men.length >= MAX_MEN) return;
      y = clamp(y, HEADER_H, window.innerHeight);
      const { el, man, bubble } = makeRunnerElement();
      const m = {
        el, man, bubble,
        alive: true,
        dying: false,
        pos: { x, y },
        vel: { x: 0, y: 0 },
        facing: 1,
        bobT: 0,
        stopUntil: 0,
        speakUntil: 0,
        lastSpeak: 0,
      };
      el.style.left = x + "px";
      el.style.top  = y + "px";
      men.push(m);
    }

    function spawnSoul(fromX, fromY, facing) {
      const s = document.createElement("div");
      s.className = "soul";
      s.style.left = fromX + "px";
      s.style.top  = fromY + "px";
      // white body + subtle outline to make it visible on white background
      s.innerHTML = manSVG("#FFFFFF", SOUL.stroke);
      document.body.appendChild(s);

      // facing
      const svg = s.querySelector("svg");
      svg.style.transformOrigin = "50% 50%";
      svg.style.transform = `scaleX(${facing})`;

      // make it slightly bigger so it reads well
      s.style.transform = `translate(-50%, -50%) scale(0.95)`;

      requestAnimationFrame(() => s.classList.add("on"));

      const driftX = (Math.random() - 0.5) * SOUL.driftX;
      const waveA  = SOUL.waveAmp[0] + Math.random() * (SOUL.waveAmp[1] - SOUL.waveAmp[0]);
      const waveF  = SOUL.waveFreq[0] + Math.random() * (SOUL.waveFreq[1] - SOUL.waveFreq[0]);

      const rise   = SOUL.risePxPerMs * (0.90 + Math.random() * 0.25); // still slow, slight variance
      const lifeMs = SOUL.lifeMs * (0.90 + Math.random() * 0.20);

      let x0 = fromX;
      let y0 = fromY;
      let t0 = null;

      function step(ts) {
        if (t0 === null) t0 = ts;
        const u = ts - t0;

        // Smooth drift + sine wave
        const nx = x0 + (driftX * (u / lifeMs)) + Math.sin(u * waveF) * waveA;
        const ny = y0 - (u * rise);

        s.style.left = nx + "px";
        s.style.top  = ny + "px";

        // fade later + slower
        const fadeU = Math.max(0, u - SOUL.fadeStart);
        const alpha = Math.max(0, 1.0 - (fadeU / (lifeMs - SOUL.fadeStart)));
        s.style.opacity = alpha.toFixed(3);

        // stop when out of screen or lifetime ended
        if (ny < -60 || u >= lifeMs || alpha <= 0.01) {
          s.remove();
          return;
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    function killMan(m) {
      if (!m.alive || m.dying) return;
      m.dying = true;

      const facing = m.facing;

      m.el.style.setProperty("--face", String(facing));
      m.el.classList.add("dying");

      // soul appears a little earlier & more visible
      setTimeout(() => spawnSoul(m.pos.x, m.pos.y, facing), 70);

      setTimeout(() => {
        m.alive = false;
        m.el.remove();
        const idx = men.indexOf(m);
        if (idx >= 0) men.splice(idx, 1);
      }, 240);
    }

    // Explosion visuals (unchanged)
    function fireballExplosion(x, y) {
      const b = document.createElement("div");
      b.className = "boom";
      b.style.left = x + "px";
      b.style.top  = y + "px";

      const shock = document.createElement("div");
      shock.className = "shock";
      const flash = document.createElement("div");
      flash.className = "flash";
      b.appendChild(flash);
      b.appendChild(shock);

      const puffs = 9;
      for (let i = 0; i < puffs; i++) {
        const puff = document.createElement("div");
        puff.className = "puff";

        const ang = (Math.PI * 2) * (i / puffs) + (Math.random() * 0.35);
        const r = 20 + Math.random() * 34;
        const dx = Math.cos(ang) * r;
        const dy = Math.sin(ang) * r;

        const size = (26 + Math.random() * 34) + "px";
        puff.style.setProperty("--s", size);
        puff.style.setProperty("--dx", dx + "px");
        puff.style.setProperty("--dy", dy + "px");
        puff.style.animationDuration = (680 + Math.random() * 240) + "ms";

        b.appendChild(puff);
      }

      const smokeCount = 6;
      for (let i = 0; i < smokeCount; i++) {
        const s = document.createElement("div");
        s.className = "smoke";

        const ang = (Math.PI * 2) * (i / smokeCount) + (Math.random() * 0.6);
        const r = 30 + Math.random() * 44;
        const dx = Math.cos(ang) * r;
        const dy = Math.sin(ang) * r - (8 + Math.random() * 16);

        const size = (34 + Math.random() * 44) + "px";
        s.style.setProperty("--s", size);
        s.style.setProperty("--dx", dx + "px");
        s.style.setProperty("--dy", dy + "px");
        s.style.animationDelay = (60 + Math.random() * 90) + "ms";

        b.appendChild(s);
      }

      document.body.appendChild(b);
      setTimeout(() => b.remove(), 1100);
    }

    function explode(x, y) {
      fireballExplosion(x, y);
      for (const m of [...men]) {
        if (!m.alive) continue;
        const dx = m.pos.x - x;
        const dy = m.pos.y - y;
        if (Math.hypot(dx, dy) <= EXPLOSION_RADIUS) killMan(m);
      }
    }

    // Controls
    window.addEventListener("pointerdown", (e) => {
      if (e.button === 2) {
        e.preventDefault();
        explode(e.clientX, e.clientY);
        return;
      }
      setTarget(e.clientX, e.clientY);
      spawnMan(e.clientX, e.clientY);
    }, { passive: false });

    // Seed
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        spawnMan(window.innerWidth * 0.30, window.innerHeight * 0.55);
        spawnMan(window.innerWidth * 0.22, window.innerHeight * 0.62);
        target = { x: window.innerWidth * 0.70, y: window.innerHeight * 0.40 };
      });
    });

    function tick(now) {
      const dt = clamp(now - (tick._last || now), 8, 28);
      tick._last = now;

      if (!hasPointer) {
        target.x = window.innerWidth * 0.70;
        target.y = window.innerHeight * 0.40;
      }

      for (const m of men) {
        if (!m.alive || m.dying) continue;

        const stopped = now < m.stopUntil;
        if (!stopped) {
          const dx = target.x - m.pos.x;
          const dy = target.y - m.pos.y;
          const dist = Math.hypot(dx, dy) || 1;

          if (Math.abs(dx) > 2) m.facing = dx >= 0 ? 1 : -1;

          const ax = (dx / dist) * CFG.accel * dt;
          const ay = (dy / dist) * CFG.accel * dt;

          m.vel.x = (m.vel.x + ax) * CFG.friction;
          m.vel.y = (m.vel.y + ay) * CFG.friction;

          const sp = Math.hypot(m.vel.x, m.vel.y) || 1;
          const maxV = CFG.maxSpeed * dt;
          if (sp > maxV) {
            m.vel.x = (m.vel.x / sp) * maxV;
            m.vel.y = (m.vel.y / sp) * maxV;
          }

          m.pos.x += m.vel.x;
          m.pos.y += m.vel.y;

          m.pos.x = clamp(m.pos.x, 0, window.innerWidth);
          m.pos.y = clamp(m.pos.y, HEADER_H, window.innerHeight);

          if (dist < CFG.catchRadius) {
            m.pos.x = target.x;
            m.pos.y = target.y;
            m.vel.x = 0; m.vel.y = 0;
            m.stopUntil = now + CFG.stopMs;

            if (now - m.lastSpeak > CFG.speakCooldownMs) {
              m.lastSpeak = now;
              m.speakUntil = now + CFG.speakMs;
              m.bubble.classList.add("on");
            }
          }

          const speed01 = clamp(sp / (maxV + 1e-6), 0, 1);
          m.bobT += dt * 0.01 * (0.6 + speed01 * 2.0);
        }

        if (m.bubble.classList.contains("on") && now > m.speakUntil) {
          m.bubble.classList.remove("on");
        }

        const bob = Math.sin(m.bobT) * 1.0;
        m.el.style.left = m.pos.x + "px";
        m.el.style.top  = (m.pos.y + bob) + "px";
        m.man.style.transform = `scaleX(${m.facing})`;
      }

      requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);
  })();
  </script>
</body>
</html>
