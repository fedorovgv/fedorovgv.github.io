
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DL engineer</title>
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: #fff; overflow: hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

    header{
      position: fixed;
      left: 0; right: 0; top: 0;
      height: 44px;
      display: flex;
      align-items: center;
      padding: 0 14px;
      font-size: 14px;
      font-weight: 650;
      border-bottom: 1px solid rgba(0,0,0,0.10);
      background: #fff;
      user-select: none;
      z-index: 10;
    }

    /* Men */
    .runner{
      position: fixed;
      left: 0; top: 0;
      width: 56px; height: 56px;
      transform: translate(-50%, -50%); /* center anchor */
      pointer-events: none;
      z-index: 1000;
      will-change: left, top, transform, opacity, filter;
      filter: drop-shadow(0 10px 10px rgba(0,0,0,0.10));
    }
    .man{
      width: 56px; height: 56px;
      transform-origin: 50% 50%;
      transform: scaleX(1);
    }
    .man svg { width: 56px; height: 56px; display: block; }

    /* Death: shrink + fade */
    .runner.dead{
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.22);
      transition: opacity 180ms ease, transform 220ms ease;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.06));
    }

    /* Speech bubble */
    .bubble{
      position:absolute;
      left: 60px;
      top: -6px;
      max-width: 280px;
      padding: 8px 10px;
      border-radius: 14px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.14);
      color: rgba(0,0,0,0.80);
      font-size: 12px;
      line-height: 1.25;
      box-shadow: 0 12px 30px rgba(0,0,0,0.10);
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity .16s ease, transform .16s ease;
      white-space: normal;
    }
    .bubble.on{ opacity: 1; transform: translateY(0); }
    .bubble:after{
      content:"";
      position:absolute;
      left: -6px; top: 18px;
      width: 10px; height: 10px;
      background: #fff;
      border-left: 1px solid rgba(0,0,0,0.14);
      border-bottom: 1px solid rgba(0,0,0,0.14);
      transform: rotate(45deg);
    }

    /* Red cloud explosion (minimal) */
    .cloud{
      position: fixed;
      left: 0; top: 0;
      width: 12px; height: 12px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 2000;
      opacity: 1;
      filter: blur(0.2px);
    }

    /* layered puffs */
    .cloud .puff{
      position: absolute;
      left: 50%; top: 50%;
      width: var(--s);
      height: var(--s);
      border-radius: 999px;
      background: rgba(255, 40, 40, 0.22);
      transform: translate(-50%, -50%) scale(0.15);
      animation: puff 520ms ease-out forwards;
      box-shadow:
        0 0 0 1px rgba(255, 40, 40, 0.10) inset;
    }

    .cloud .ring{
      position: absolute;
      left: 50%; top: 50%;
      width: 18px; height: 18px;
      border-radius: 999px;
      border: 2px solid rgba(255, 40, 40, 0.28);
      transform: translate(-50%, -50%) scale(0.15);
      opacity: 0.9;
      animation: ring 560ms ease-out forwards;
    }

    @keyframes puff{
      0%   { transform: translate(-50%, -50%) scale(0.12); opacity: 0.75; }
      60%  { opacity: 0.55; }
      100% { transform: translate(calc(-50% + var(--dx)), calc(-50% + var(--dy))) scale(1.15); opacity: 0; }
    }
    @keyframes ring{
      0%   { transform: translate(-50%, -50%) scale(0.10); opacity: 0.9; }
      100% { transform: translate(-50%, -50%) scale(2.2); opacity: 0; }
    }
  </style>
</head>
<body>
  <header>DL engineer</header>

  <script>
  (() => {
    // ---- Config ----
    const MAX_MEN = 15;
    const EXPLOSION_RADIUS = 130; // px
    const HEADER_H = 44;

    const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches;
    const CFG = {
      accel: prefersReducedMotion ? 0.004 : 0.020,
      maxSpeed: prefersReducedMotion ? 0.45 : 1.60,
      friction: 0.86,
      catchRadius: 12,
      stopMs: 240,
      speakMs: 1300,
      speakCooldownMs: 650,
    };

    // Disable context menu so right-click works
    window.addEventListener("contextmenu", (e) => e.preventDefault());

    // Target follows cursor
    let target = { x: window.innerWidth * 0.6, y: window.innerHeight * 0.6 };
    let hasPointer = false;

    function setTarget(x, y) {
      hasPointer = true;
      target.x = x;
      target.y = y;
    }

    window.addEventListener("pointermove", (e) => setTarget(e.clientX, e.clientY), { passive: true });

    // Men state
    const men = [];

    // Our own smoother “guy” (rounded shapes, more even proportions)
    function manSVG() {
      return `
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <!-- head -->
          <circle cx="32" cy="14" r="9.2" fill="#FFD400"/>
          <!-- torso -->
          <path d="M24.5 24
                   C24.5 20.5 39.5 20.5 39.5 24
                   L40.8 38
                   C41.5 45 22.5 45 23.2 38
                   Z" fill="#FFD400"/>
          <!-- left arm (smooth) -->
          <path d="M24 27
                   C16.5 29 12.3 34 11.5 38
                   C10.9 41 14.2 43 16.2 40.7
                   C18.4 38.1 20.5 35.3 26 34.4
                   Z" fill="#FFD400"/>
          <!-- right arm -->
          <path d="M40 27
                   C47.5 29 51.7 34 52.5 38
                   C53.1 41 49.8 43 47.8 40.7
                   C45.6 38.1 43.5 35.3 38 34.4
                   Z" fill="#FFD400"/>
          <!-- left leg -->
          <path d="M28 41
                   C23.8 47.5 20.8 53 20.2 57
                   C20 60 24.2 60.6 26.1 57.8
                   C29 53.6 31.2 48.6 33 45.5
                   Z" fill="#FFD400"/>
          <!-- right leg -->
          <path d="M36 41
                   C40.2 47.5 43.2 53 43.8 57
                   C44 60 39.8 60.6 37.9 57.8
                   C35 53.6 32.8 48.6 31 45.5
                   Z" fill="#FFD400"/>
        </svg>
      `;
    }

    function makeRunnerElement() {
      const el = document.createElement("div");
      el.className = "runner";

      const man = document.createElement("div");
      man.className = "man";
      man.innerHTML = manSVG();

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = "smnth will be later here, now go away";

      el.appendChild(man);
      el.appendChild(bubble);
      document.body.appendChild(el);

      return { el, man, bubble };
    }

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    function spawnMan(x, y) {
      if (men.length >= MAX_MEN) return;
      y = clamp(y, HEADER_H, window.innerHeight);
      const { el, man, bubble } = makeRunnerElement();
      const m = {
        el, man, bubble,
        alive: true,
        pos: { x, y },
        vel: { x: 0, y: 0 },
        facing: 1,
        bobT: 0,
        stopUntil: 0,
        speakUntil: 0,
        lastSpeak: 0,
      };
      el.style.left = x + "px";
      el.style.top = y + "px";
      men.push(m);
    }

    function killMan(m) {
      if (!m.alive) return;
      m.alive = false;
      m.el.classList.add("dead");
      setTimeout(() => {
        m.el.remove();
        const idx = men.indexOf(m);
        if (idx >= 0) men.splice(idx, 1);
      }, 260);
    }

    // Red cloud explosion
    function cloudExplosion(x, y) {
      const c = document.createElement("div");
      c.className = "cloud";
      c.style.left = x + "px";
      c.style.top  = y + "px";

      const ring = document.createElement("div");
      ring.className = "ring";
      c.appendChild(ring);

      // 7–9 puffs
      const puffs = 8;
      for (let i = 0; i < puffs; i++) {
        const p = document.createElement("div");
        p.className = "puff";
        const ang = (Math.PI * 2) * (i / puffs) + (Math.random() * 0.35);
        const r = 24 + Math.random() * 28;
        const dx = Math.cos(ang) * r;
        const dy = Math.sin(ang) * r;

        const size = (24 + Math.random() * 26) + "px";
        p.style.setProperty("--s", size);
        p.style.setProperty("--dx", dx + "px");
        p.style.setProperty("--dy", dy + "px");
        p.style.animationDuration = (460 + Math.random() * 220) + "ms";
        c.appendChild(p);
      }

      document.body.appendChild(c);
      setTimeout(() => c.remove(), 760);
    }

    function explode(x, y) {
      cloudExplosion(x, y);

      // kill within radius
      for (const m of [...men]) {
        if (!m.alive) continue;
        const dx = m.pos.x - x;
        const dy = m.pos.y - y;
        if (Math.hypot(dx, dy) <= EXPLOSION_RADIUS) killMan(m);
      }
    }

    // Controls:
    // - Left click: spawn (up to 15) + set target
    // - Right click: explosion
    window.addEventListener("pointerdown", (e) => {
      if (e.button === 2) {
        e.preventDefault();
        explode(e.clientX, e.clientY);
        return;
      }
      setTarget(e.clientX, e.clientY);
      spawnMan(e.clientX, e.clientY);
    }, { passive: false });

    // Seed a few at start (nice, but still minimal)
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        spawnMan(window.innerWidth * 0.30, window.innerHeight * 0.55);
        spawnMan(window.innerWidth * 0.22, window.innerHeight * 0.62);
        // default target so they move even before first mouse move
        target = { x: window.innerWidth * 0.70, y: window.innerHeight * 0.35 };
      });
    });

    // Loop
    function tick(now) {
      const dt = clamp(now - (tick._last || now), 8, 28);
      tick._last = now;

      if (!hasPointer) {
        // gentle default drift
        target.x = window.innerWidth * 0.70;
        target.y = window.innerHeight * 0.40;
      }

      for (const m of men) {
        if (!m.alive) continue;

        const stopped = now < m.stopUntil;
        if (!stopped) {
          const dx = target.x - m.pos.x;
          const dy = target.y - m.pos.y;
          const dist = Math.hypot(dx, dy) || 1;

          if (Math.abs(dx) > 2) m.facing = dx >= 0 ? 1 : -1;

          const ax = (dx / dist) * CFG.accel * dt;
          const ay = (dy / dist) * CFG.accel * dt;

          m.vel.x = (m.vel.x + ax) * CFG.friction;
          m.vel.y = (m.vel.y + ay) * CFG.friction;

          const sp = Math.hypot(m.vel.x, m.vel.y) || 1;
          const maxV = CFG.maxSpeed * dt;
          if (sp > maxV) {
            m.vel.x = (m.vel.x / sp) * maxV;
            m.vel.y = (m.vel.y / sp) * maxV;
          }

          m.pos.x += m.vel.x;
          m.pos.y += m.vel.y;

          m.pos.x = clamp(m.pos.x, 0, window.innerWidth);
          m.pos.y = clamp(m.pos.y, HEADER_H, window.innerHeight);

          // Catch
          if (dist < CFG.catchRadius) {
            m.pos.x = target.x;
            m.pos.y = target.y;
            m.vel.x = 0; m.vel.y = 0;
            m.stopUntil = now + CFG.stopMs;

            if (now - m.lastSpeak > CFG.speakCooldownMs) {
              m.lastSpeak = now;
              m.speakUntil = now + CFG.speakMs;
              m.bubble.classList.add("on");
            }
          }

          const speed01 = clamp(sp / (maxV + 1e-6), 0, 1);
          m.bobT += dt * 0.01 * (0.6 + speed01 * 2.0);
        }

        if (m.bubble.classList.contains("on") && now > m.speakUntil) {
          m.bubble.classList.remove("on");
        }

        const bob = Math.sin(m.bobT) * 1.0;
        m.el.style.left = m.pos.x + "px";
        m.el.style.top  = (m.pos.y + bob) + "px";
        m.man.style.transform = `scaleX(${m.facing})`;
      }

      requestAnimationFrame(tick);
    }

    requestAnimationFrame(tick);
  })();
  </script>
</body>
</html>
